<!-- ЁЯОи Apple iOS Design - ф╝ЪшооходхИЧшбищб╡щЭв -->
<view class="ios-app-container">
  <!-- iOS щгОца╝хп╝шИкцаП -->
  <view class="ios-navbar" style="padding-top: {{statusBarHeight}}px;">
    <view class="navbar-content">
      <view class="nav-left"></view>
      <text class="nav-title">ф╝ЪшооходщвДшов</text>
      <view class="nav-right" bindtap="goToAdminPanel" wx:if="{{isAdmin}}">
        <view class="nav-button">
          <image class="nav-icon" src="/images/icons/admin.png" mode="aspectFit"></image>
        </view>
      </view>
      <view class="nav-right" wx:else></view>
    </view>
  </view>

  <!-- цРЬч┤вцаП - ш░ГцХ┤ф╜Нч╜о -->
  <view class="search-section" style="top: {{statusBarHeight + 44}}px;">
    <view class="search-bar">
      <image class="search-icon" src="/images/icons/search.png" mode="aspectFit"></image>
      <input
        class="search-input"
        placeholder="цРЬч┤вф╝Ъшооход"
        placeholder-class="search-placeholder"
        confirm-type="search"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
        value="{{searchKeyword}}"
      />
      <view wx:if="{{searchKeyword}}" class="clear-button" bindtap="clearSearch">
        <image class="clear-icon" src="/images/icons/close.png" mode="aspectFit"></image>
      </view>
    </view>
    
    <!-- чнЫщАЙцМЙщТо -->
    <view class="filter-button" bindtap="showFilterOptions">
      <image class="filter-icon" src="/images/icons/filter.png" mode="aspectFit"></image>
    </view>
  </view>

  <!-- ф╕╗шжБхЖЕхо╣хМ║хЯЯ -->
  <view class="main-content" style="padding-top: {{statusBarHeight + 104}}px;">
    
    <!-- хКаш╜╜чК╢цАБ -->
    <view wx:if="{{loading}}" class="loading-view">
      <view class="ios-activity-indicator">
        <view class="spinner"></view>
        <text class="loading-label">цнгхЬихКаш╜╜...</text>
      </view>
    </view>

    <!-- чй║чК╢цАБ -->
    <view wx:elif="{{!loading && rooms.length === 0}}" class="empty-view">
      <view class="empty-content">
        <view class="empty-icon">
          <image class="empty-image" src="/images/icons/empty.png" mode="aspectFit"></image>
        </view>
        <text class="empty-title">{{searchKeyword ? 'цЬкцЙ╛хИ░чЫ╕хЕ│ф╝Ъшооход' : 'цЪВцЧаф╝Ъшооход'}}</text>
        <text class="empty-subtitle">{{searchKeyword ? 'шп╖х░ЭшпХхЕ╢ф╗ЦхЕ│щФошпН' : 'ф╕ЛцЛЙхИ╖цЦ░цИЦшБФч│╗чобчРЖхСШ'}}</text>
        <button wx:if="{{searchKeyword}}" class="ios-button secondary" bindtap="clearSearch">
          ц╕ЕщЩдцРЬч┤в
        </button>
      </view>
    </view>

    <!-- хЖЕхо╣хМ║хЯЯ -->
    <view wx:else class="content-wrapper">
      
      <!-- цХ░цНоч╗ЯшобхНбчЙЗ -->
      <view class="stats-section">
        <view class="stats-card">
          <view class="stats-header">
            <text class="stats-title">ф╗КцЧецжВшзИ</text>
            <text class="stats-time">{{currentTime}}</text>
          </view>
          <view class="stats-grid">
            <view class="stat-item">
              <text class="stat-number">{{stats.totalRooms}}</text>
              <text class="stat-label">цА╗ф╝Ъшооход</text>
            </view>
            <view class="stat-item">
              <text class="stat-number available">{{stats.availableRooms}}</text>
              <text class="stat-label">хПпчФиф╝Ъшооход</text>
            </view>
            <view class="stat-item">
              <text class="stat-number occupied">{{stats.occupiedRooms}}</text>
              <text class="stat-label">ф╜┐чФиф╕н</text>
            </view>
            <view class="stat-item">
              <text class="stat-number">{{stats.todayBookings}}</text>
              <text class="stat-label">ф╗КцЧещвДч║ж</text>
            </view>
          </view>
        </view>
      </view>

      <!-- х┐лщАЯцУНф╜ЬхМ║хЯЯ -->
      <view class="quick-actions-section">
        <view class="section-header">
          <text class="section-title">х┐лщАЯцУНф╜Ь</text>
        </view>
        <view class="quick-actions-grid">
          <view class="quick-action-item" bindtap="quickBookToday">
            <view class="action-icon calendar">
              <image src="/images/icons/calendar.png" mode="aspectFit"></image>
            </view>
            <text class="action-text">ф╗КцЧещвДч║ж</text>
          </view>
          <view class="quick-action-item" bindtap="goToMyBookings">
            <view class="action-icon bookings">
              <image src="/images/icons/bookmark.png" mode="aspectFit"></image>
            </view>
            <text class="action-text">цИСчЪДщвДч║ж</text>
          </view>
          <view class="quick-action-item" bindtap="showCapacityFilter">
            <view class="action-icon filter">
              <image src="/images/icons/filter.png" mode="aspectFit"></image>
            </view>
            <text class="action-text">цМЙхо╣щЗПчнЫщАЙ</text>
          </view>
          <view class="quick-action-item" bindtap="showPopularRooms">
            <view class="action-icon popular">
              <image src="/images/icons/star.png" mode="aspectFit"></image>
            </view>
            <text class="action-text">чГнщЧиф╝Ъшооход</text>
          </view>
        </view>
      </view>

      <!-- цОишНРф╝Ъшооход -->
      <view wx:if="{{recommendedRooms.length > 0}}" class="recommended-section">
        <view class="section-header">
          <text class="section-title">цОишНРф╝Ъшооход</text>
          <text class="section-subtitle">ца╣цНоцВичЪДф╜┐чФиф╣ацГпцОишНР</text>
        </view>
        <scroll-view class="recommended-scroll" scroll-x show-scrollbar="{{false}}">
          <view class="recommended-list">
            <view wx:for="{{recommendedRooms}}" wx:key="id" 
                  class="recommended-card" 
                  data-room="{{item}}"
                  bindtap="goToRoomDetail">
              <view class="recommended-image">
                <image 
                  class="room-thumbnail" 
                  src="{{item.displayImage}}" 
                  mode="aspectFill"
                  lazy-load
                />
                <view class="recommended-badge">цОишНР</view>
              </view>
              <view class="recommended-info">
                <text class="recommended-name">{{item.name}}</text>
                <text class="recommended-capacity">{{item.capacity}}ф║║</text>
              </view>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- ф╝ЪшооходхИЧшбицаЗщвШ -->
      <view class="section-header">
        <text class="section-title">хЕищГиф╝Ъшооход</text>
        <text class="section-subtitle">хЕ▒{{rooms.length}}щЧ┤ф╝Ъшооход</text>
      </view>

      <!-- ф╝ЪшооходхИЧшби -->
      <scroll-view
        class="room-list"
        scroll-y
        bindscrolltolower="onReachBottom"
        refresher-enabled="{{true}}"
        refresher-triggered="{{refreshing}}"
        bindrefresherrefresh="onRefresh"
      >
        <view class="room-grid">
          <view wx:for="{{rooms}}" wx:key="id" 
                class="room-card-wrapper" 
                data-room="{{item}}"
                bindtap="goToRoomDetail">
            
            <view class="room-card">
              <!-- цИ┐щЧ┤хЫ╛чЙЗ -->
              <view class="room-image-container">
                <image 
                  wx:if="{{!item.imageError}}"
                  class="room-image" 
                  src="{{item.displayImage}}" 
                  mode="aspectFill" 
                  lazy-load
                  binderror="onImageError"
                  bindload="onImageLoad"
                  data-room-id="{{item.id}}"
                />
                <view wx:else class="room-image-placeholder">
                  <image class="placeholder-icon" src="/images/icons/image-placeholder.png" mode="aspectFit"></image>
                </view>
                
                <!-- чК╢цАБцаЗчн╛ -->
                <view class="status-chip image-status-chip {{item.status === 'available' ? 'available' : 'occupied'}}">
                  <text class="status-text">{{item.status === 'available' ? 'хПпщвДч║ж' : 'х╖▓хНачФи'}}</text>
                </view>
              </view>

              <!-- цИ┐щЧ┤ф┐бцБп -->
              <view class="room-info">
                <view class="room-header">
                  <text class="room-name">{{item.name}}</text>
                  <view class="capacity-badge">
                    <image class="capacity-icon" src="/images/icons/people.png" mode="aspectFit"></image>
                    <text class="capacity-text">{{item.capacity}}ф║║</text>
                  </view>
                </view>
                
                <view class="room-location">
                  <image class="location-icon" src="/images/icons/location.png" mode="aspectFit"></image>
                  <text class="location-text">{{item.location}}</text>
                </view>
                
                <!-- хПпчФицАзчК╢цАБцЭб -->
                <view class="availability-bar">
                  <view class="availability-info">
                    <view class="status-dot {{item.status}}"></view>
                    <text class="status-text">{{item.status === 'available' ? 'члЛхН│хПпчФи' : 'ф╜┐чФиф╕н'}}</text>
                  </view>
                  <view class="next-available" wx:if="{{item.status === 'occupied'}}">
                    <text class="next-time">14:00хРОхПпчФи</text>
                  </view>
                </view>
                
                <text class="room-description">{{item.description || 'чО░ф╗гхМЦф╝Ъшооходя╝МщЕНхдЗхоМхЦДшо╛цЦ╜'}}</text>
                
                <!-- ф╝ЪшооходчЙ╣шЙ▓цаЗчн╛ -->
                <view class="room-features">
                  <view class="feature-item" wx:if="{{item.capacity >= 20}}">
                    <image class="feature-icon" src="/images/icons/meeting-room.png" mode="aspectFit"></image>
                    <text class="feature-text">хдзхЮЛф╝Ъшоо</text>
                  </view>
                  <view class="feature-item" wx:if="{{item.equipment && item.equipment.includes('цКХх╜▒шо╛хдЗ')}}">
                    <image class="feature-icon" src="/images/icons/camera.png" mode="aspectFit"></image>
                    <text class="feature-text">цКХх╜▒шо╛хдЗ</text>
                  </view>
                  <view class="feature-item" wx:if="{{item.equipment && item.equipment.includes('шзЖщвСф╝Ъшоошо╛хдЗ')}}">
                    <image class="feature-icon" src="/images/icons/contact.png" mode="aspectFit"></image>
                    <text class="feature-text">шзЖщвСф╝Ъшоо</text>
                  </view>
                  <view class="feature-item" wx:if="{{item.capacity <= 8}}">
                    <image class="feature-icon" src="/images/icons/user.png" mode="aspectFit"></image>
                    <text class="feature-text">чзБхпЖчй║щЧ┤</text>
                  </view>
                </view>
                
                <!-- шо╛хдЗцаЗчн╛ -->
                <view wx:if="{{item.equipment && item.equipment.length > 0}}" class="equipment-tags">
                  <view wx:for="{{item.equipment}}" wx:key="*this" 
                        wx:for-item="equipment"
                        class="equipment-tag">
                    <text class="equipment-text">{{equipment}}</text>
                  </view>
                </view>
                
                <!-- щвДч║жч╗Яшобф┐бцБп -->
                <view class="booking-stats">
                  <view class="stat-item">
                    <image class="stat-icon" src="/images/icons/calendar.png" mode="aspectFit"></image>
                    <view class="stat-info">
                      <text class="stat-number">{{item.todayBookings || 0}}</text>
                      <text class="stat-label">ф╗КцЧещвДч║ж</text>
                    </view>
                  </view>
                  <view class="stat-item">
                    <image class="stat-icon" src="/images/icons/history.png" mode="aspectFit"></image>
                    <view class="stat-info">
                      <text class="stat-number">{{item.popularity || 85}}%</text>
                      <text class="stat-label">ф╜┐чФичОЗ</text>
                    </view>
                  </view>
                  <view class="stat-item">
                    <image class="stat-icon" src="/images/icons/star.png" mode="aspectFit"></image>
                    <view class="stat-info">
                      <text class="stat-number">{{item.rating || 4.8}}</text>
                      <text class="stat-label">шпДхИЖ</text>
                    </view>
                  </view>
                </view>
                
                <!-- цЧ╢щЧ┤ф┐бцБп -->
                <view class="time-info">
                  <view class="time-item">
                    <text class="time-label">х╝АцФ╛цЧ╢щЧ┤</text>
                    <text class="time-value">08:00 - 22:00</text>
                  </view>
                  <view class="time-item" wx:if="{{item.nextBooking}}">
                    <text class="time-label">ф╕ЛцмбщвДч║ж</text>
                    <text class="time-value">{{item.nextBooking || 'цЪВцЧа'}}</text>
                  </view>
                </view>
                
                <!-- х║ХщГишбМхКихМ║хЯЯ -->
                <view class="room-actions">
                  <view class="action-buttons">
                    <button class="action-btn primary" 
                            data-room="{{item}}"
                            bindtap="quickBookRoom"
                            catchtap="true">
                      <image class="btn-icon" src="/images/icons/booking.png" mode="aspectFit"></image>
                      члЛхН│щвДч║ж
                    </button>
                    <button class="action-btn secondary" 
                            data-room="{{item}}"
                            bindtap="previewRoom"
                            catchtap="true">
                      <image class="btn-icon" src="/images/icons/search.png" mode="aspectFit"></image>
                      цЯечЬЛшпжцГЕ
                    </button>
                  </view>
                  
                  <!-- х┐лщАЯцУНф╜Ь -->
                  <view class="quick-operations">
                    <view class="quick-op-item" data-room="{{item}}" bindtap="addToFavorites" catchtap="true">
                      <image class="op-icon" src="/images/icons/star.png" mode="aspectFit"></image>
                    </view>
                    <view class="quick-op-item" data-room="{{item}}" bindtap="shareRoom" catchtap="true">
                      <image class="op-icon" src="/images/icons/export.png" mode="aspectFit"></image>
                    </view>
                    <view class="quick-op-item" data-room="{{item}}" bindtap="showRoomMap" catchtap="true">
                      <image class="op-icon" src="/images/icons/location.png" mode="aspectFit"></image>
                    </view>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- хКаш╜╜цЫ┤хдЪ -->
        <view wx:if="{{loadingMore}}" class="loading-more">
          <view class="mini-spinner"></view>
          <text class="loading-more-text">цнгхЬихКаш╜╜цЫ┤хдЪ...</text>
        </view>

        <!-- х║ХщГищЧ┤ш╖Э -->
        <view class="bottom-spacing"></view>
      </scroll-view>
    </view>

  </view>

</view> 