# å¾®ä¿¡å¤´åƒè·å–åŠŸèƒ½æŒ‡å—

## ğŸ“– åŠŸèƒ½æ¦‚è¿°

æœ¬ç³»ç»Ÿæ–°å¢äº†ä¾¿æ·çš„å¾®ä¿¡å¤´åƒè·å–åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è½»æ¾è·å–å¹¶ä¸Šä¼ å¾®ä¿¡å¤´åƒã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### 1. ä¸‰ç§å¤´åƒè·å–æ–¹å¼
- **ç›´æ¥è·å–å¾®ä¿¡å¤´åƒ** - ä½¿ç”¨ `wx.chooseAvatar()` APIï¼ˆæ¨èï¼‰
- **è·å–ç”¨æˆ·ä¿¡æ¯åŒ…å«å¤´åƒ** - ä½¿ç”¨ `wx.getUserProfile()` API
- **ä»ç›¸å†Œé€‰æ‹©æˆ–æ‹ç…§** - ä¼ ç»Ÿçš„å›¾ç‰‡é€‰æ‹©æ–¹å¼

### 2. ä¾¿æ·çš„æ“ä½œæµç¨‹
1. ç”¨æˆ·ç‚¹å‡»å¤´åƒåŒºåŸŸ
2. å¼¹å‡ºé€‰æ‹©èœå•ï¼š
   - ä½¿ç”¨å¾®ä¿¡å¤´åƒ
   - ä»ç›¸å†Œé€‰æ‹©
   - æ‹ç…§
3. è‡ªåŠ¨ä¸Šä¼ åˆ°æœåŠ¡å™¨
4. æ›´æ–°ç”¨æˆ·ä¿¡æ¯

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### å‰ç«¯æ ¸å¿ƒæ–¹æ³•

#### 1. WechatAuth å·¥å…·ç±»æ–°å¢æ–¹æ³•

```javascript
// è·å–å¾®ä¿¡å¤´åƒ
WechatAuth.getWechatAvatar()

// è·å–å¾®ä¿¡ç”¨æˆ·ä¿¡æ¯ï¼ˆåŒ…å«å¤´åƒï¼‰
WechatAuth.getWechatUserInfo()

// ç™»å½•å¹¶è·å–ç”¨æˆ·ä¿¡æ¯
WechatAuth.loginWithUserInfo()
```

#### 2. Profile é¡µé¢æ–°å¢æ–¹æ³•

```javascript
// é€‰æ‹©å¤´åƒè·å–æ–¹å¼
chooseAvatarMethod()

// è·å–å¾®ä¿¡å¤´åƒ
getWechatAvatar()

// è·å–å¾®ä¿¡ç”¨æˆ·ä¿¡æ¯
getWechatUserProfile()

// ä¸Šä¼ å¤´åƒåˆ°æœåŠ¡å™¨
uploadAvatarToServer()

// æ›´æ–°ç”¨æˆ·æ˜µç§°
updateUserNickname()
```

### ä½¿ç”¨ç¤ºä¾‹

#### ç›´æ¥è·å–å¾®ä¿¡å¤´åƒ
```javascript
try {
    const avatarUrl = await WechatAuth.getWechatAvatar();
    console.log('è·å–åˆ°å¤´åƒ:', avatarUrl);
    // è¿›è¡Œåç»­å¤„ç†
} catch (error) {
    console.error('è·å–å¤±è´¥:', error);
}
```

#### è·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯
```javascript
try {
    const userInfo = await WechatAuth.getWechatUserInfo();
    console.log('ç”¨æˆ·ä¿¡æ¯:', {
        nickName: userInfo.nickName,
        avatarUrl: userInfo.avatarUrl,
        gender: userInfo.gender,
        country: userInfo.country,
        province: userInfo.province,
        city: userInfo.city
    });
} catch (error) {
    console.error('è·å–å¤±è´¥:', error);
}
```

## ğŸ§ª æµ‹è¯•åŠŸèƒ½

### æµ‹è¯•é¡µé¢åŠŸèƒ½
è®¿é—®æµ‹è¯•é¡µé¢ `/pages/test/test` å¯ä»¥æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **è·å–å¾®ä¿¡å¤´åƒæµ‹è¯•**
   - æµ‹è¯• `wx.chooseAvatar()` API
   - æ˜¾ç¤ºè·å–åˆ°çš„å¤´åƒ

2. **è·å–ç”¨æˆ·ä¿¡æ¯æµ‹è¯•**
   - æµ‹è¯• `wx.getUserProfile()` API
   - æ˜¾ç¤ºå®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯

3. **ç™»å½•+è·å–ä¿¡æ¯æµ‹è¯•**
   - å®Œæ•´çš„ç™»å½•æµç¨‹
   - è‡ªåŠ¨è·å–ç”¨æˆ·ä¿¡æ¯

4. **å¤´åƒä¸Šä¼ æµ‹è¯•**
   - æµ‹è¯•å¤´åƒä¸Šä¼ åˆ°æœåŠ¡å™¨
   - éªŒè¯æœåŠ¡å™¨å“åº”

### æµ‹è¯•æ­¥éª¤
1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. å¯¼èˆªåˆ°æµ‹è¯•é¡µé¢
3. ä¾æ¬¡ç‚¹å‡»æµ‹è¯•æŒ‰é’®
4. æŸ¥çœ‹æµ‹è¯•ç»“æœå’Œæ—¥å¿—

## ğŸ”§ é…ç½®è¯´æ˜

### å¾®ä¿¡å°ç¨‹åºé…ç½®
ç¡®ä¿åœ¨ `app.json` ä¸­é…ç½®äº†å¿…è¦çš„æƒé™ï¼š

```json
{
  "permission": {
    "scope.userInfo": {
      "desc": "ç”¨äºæ˜¾ç¤ºæ‚¨çš„å¤´åƒå’Œæ˜µç§°"
    }
  }
}
```

### åç«¯é…ç½®
ç¡®ä¿åç«¯æœ‰å¯¹åº”çš„å¤´åƒä¸Šä¼ æ¥å£ï¼š
- è·¯å¾„: `/api/upload/avatar`
- æ–¹æ³•: POST
- è®¤è¯: é€šè¿‡ `x-user-openid` header

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. APIç‰ˆæœ¬è¦æ±‚
- `wx.chooseAvatar()` éœ€è¦å¾®ä¿¡åŸºç¡€åº“ç‰ˆæœ¬ 2.21.0 åŠä»¥ä¸Š
- **å·²å®ç°å…¼å®¹æ€§å¤„ç†**: å½“APIä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§åˆ°å…¶ä»–æ–¹å¼
- å»ºè®®åœ¨ä½¿ç”¨å‰æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§

### 2. ç”¨æˆ·æƒé™
- `wx.getUserProfile()` éœ€è¦ç”¨æˆ·ä¸»åŠ¨æˆæƒ
- ç”¨æˆ·å¯èƒ½æ‹’ç»æˆæƒï¼Œéœ€è¦åšå¥½é”™è¯¯å¤„ç†

### 3. ç½‘ç»œç¯å¢ƒ
- å¤´åƒä¸Šä¼ éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
- å»ºè®®æ·»åŠ é‡è¯•æœºåˆ¶

### 4. æ–‡ä»¶å¤§å°é™åˆ¶
- å¾®ä¿¡å¤´åƒä¸€èˆ¬è¾ƒå°ï¼Œæ— éœ€ç‰¹æ®Šå¤„ç†
- ç›¸å†Œå›¾ç‰‡å¯èƒ½è¾ƒå¤§ï¼Œå»ºè®®å‹ç¼©åä¸Šä¼ 

## ğŸ› å¸¸è§é—®é¢˜

### Q: wx.chooseAvatar is not a function
**A:** æ£€æŸ¥å¾®ä¿¡åŸºç¡€åº“ç‰ˆæœ¬ï¼Œéœ€è¦ 2.21.0 åŠä»¥ä¸Š

### Q: ç”¨æˆ·æ‹’ç»æˆæƒæ€ä¹ˆåŠï¼Ÿ
**A:** æä¾›å‹å¥½æç¤ºï¼Œå¼•å¯¼ç”¨æˆ·ä½¿ç”¨å…¶ä»–æ–¹å¼ï¼ˆç›¸å†Œé€‰æ‹©ã€æ‹ç…§ï¼‰

### Q: å¤´åƒä¸Šä¼ å¤±è´¥
**A:** æ£€æŸ¥ç½‘ç»œè¿æ¥ã€æœåŠ¡å™¨çŠ¶æ€ã€ç”¨æˆ·è®¤è¯çŠ¶æ€

### Q: å¤´åƒä¸æ˜¾ç¤º
**A:** æ£€æŸ¥å›¾ç‰‡URLæ ¼å¼ã€æœåŠ¡å™¨æ–‡ä»¶è®¿é—®æƒé™

## ğŸ“± ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 1. åŠ è½½çŠ¶æ€
- æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
- é˜²æ­¢é‡å¤æ“ä½œ

### 2. é”™è¯¯æç¤º
- å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- æä¾›è§£å†³å»ºè®®

### 3. ç•Œé¢åé¦ˆ
- å®æ—¶æ˜¾ç¤ºå¤´åƒæ›´æ–°
- æˆåŠŸæç¤ºåŠ¨ç”»

## ğŸ”„ æ›´æ–°æ—¥å¿—

### Version 1.0.0 (2024-01-XX)
- âœ… æ–°å¢ `wx.chooseAvatar()` æ”¯æŒ
- âœ… ä¼˜åŒ–å¤´åƒé€‰æ‹©æµç¨‹
- âœ… æ·»åŠ å®Œæ•´æµ‹è¯•åŠŸèƒ½
- âœ… åˆ›å»ºä½¿ç”¨æŒ‡å—æ–‡æ¡£

---

> ğŸ’¡ **æç¤º**: å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·å…ˆæŸ¥çœ‹æµ‹è¯•é¡µé¢çš„è¯¦ç»†æ—¥å¿—ï¼Œæˆ–è”ç³»å¼€å‘å›¢é˜Ÿè·å–æ”¯æŒã€‚

## ğŸš¨ é‡è¦æ›´æ–°ï¼šå¾®ä¿¡æˆæƒè§„èŒƒè°ƒæ•´

### âš ï¸ æ–°çš„å¾®ä¿¡æˆæƒè¦æ±‚
- **`wx.getUserProfile` æ¥å£è°ƒæ•´**ï¼šåœ¨åŸºç¡€åº“2.27.1åŠä»¥ä¸Šç‰ˆæœ¬å·²è¢«æ”¶å›
- **æ¨èä½¿ç”¨ã€Œå¤´åƒæ˜µç§°å¡«å†™èƒ½åŠ›ã€**ï¼šåŸºç¡€åº“ 2.21.2 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ `wx.chooseAvatar`
- **`desc` å‚æ•°è¦æ±‚**ï¼šå¿…é¡»æ˜¯å£°æ˜è·å–ç”¨æˆ·ä¸ªäººä¿¡æ¯åçš„ç”¨é€”ï¼Œ**ä¸è¶…è¿‡30ä¸ªå­—ç¬¦**

### ğŸ“‹ å½“å‰ç³»ç»Ÿä½¿ç”¨çš„æè¿°æ–‡æ¡ˆ
| ä½¿ç”¨åœºæ™¯ | æè¿°æ–‡æ¡ˆ | å­—ç¬¦æ•° |
|---------|----------|--------|
| åŸºç¡€ç™»å½• | `ç”¨äºå®Œå–„é¢„çº¦æœåŠ¡` | 9å­—ç¬¦ âœ… |
| å¤´åƒè·å– | `ç”¨äºæ˜¾ç¤ºæ‚¨çš„å¤´åƒå’Œæ˜µç§°` | 12å­—ç¬¦ âœ… |
| ä¼šè®®å®¤é¢„çº¦ | `ç”¨äºå®Œå–„ä¼šè®®å®¤é¢„çº¦æœåŠ¡` | 13å­—ç¬¦ âœ… |
| ä¸ªäººèµ„æ–™ | `ç”¨äºè·å–æ‚¨çš„å¤´åƒå’Œæ˜µç§°` | 12å­—ç¬¦ âœ… |

### ğŸ”„ APIè¿ç§»å»ºè®®
æ¨èä½¿ç”¨æ–°çš„ã€Œå¤´åƒæ˜µç§°å¡«å†™èƒ½åŠ›ã€ï¼š
```javascript
// æ¨èï¼šä½¿ç”¨ wx.chooseAvatarï¼ˆéœ€è¦åŸºç¡€åº“ 2.21.2+ï¼‰
wx.chooseAvatar({
    success: (res) => {
        console.log('è·å–å¤´åƒæˆåŠŸ:', res.avatarUrl);
    }
});

// å¤‡é€‰ï¼šä»å¯ä½¿ç”¨ wx.getUserProfileï¼ˆä½†æœ‰è¢«æ”¶å›çš„é£é™©ï¼‰
wx.getUserProfile({
    desc: 'ç”¨äºæ˜¾ç¤ºæ‚¨çš„å¤´åƒå’Œæ˜µç§°', // ä¸¥æ ¼æ§åˆ¶åœ¨30å­—ç¬¦å†…
    success: (res) => {
        console.log('è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ:', res.userInfo);
    }
});
``` 